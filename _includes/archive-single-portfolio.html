{% include base_path %}

{% if post.id %}
  {% assign title = post.title | markdownify | remove: "<p>" | remove: "</p>" %}
{% else %}
  {% assign title = post.title %}
{% endif %}
{% assign title_key = post.title | strip %}

<div class="list__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork" style="background-color: white; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-radius: 4px; padding: 1.5em; margin-bottom: 1.5em;">
    <style>
      .portfolio-excerpt {
        display: flex;
        flex-wrap: wrap;
        align-items: flex-start;
        gap: 0.5em;
      }
      .portfolio-excerpt-text {
        flex: 1;
        min-width: 200px;
      }
      .portfolio-excerpt-images {
        flex-shrink: 0;
        display: flex;
        flex-direction: row;
        gap: 0.5em;
        align-items: flex-start;
        flex-wrap: wrap;
      }
      .portfolio-excerpt img {
        max-width: 180px !important;
        height: auto !important;
        display: block !important;
        float: none !important;
        margin: 0 !important;
      }
    </style>
    <h2 class="archive__item-title" itemprop="headline" style="margin-top: 0; display: flex; align-items: center; flex-wrap: wrap; gap: 0.5em;">
      {% if post.link %}
        <a href="{{ post.link }}">{{ title }}</a> <a href="{{ base_path }}{{ post.url }}" rel="permalink"><i class="fa fa-link" aria-hidden="true" title="permalink"></i><span class="sr-only">Permalink</span></a>
      {% else %}
        <a href="{{ base_path }}{{ post.url }}" rel="permalink">{{ title }}</a>
      {% endif %}
      {% if title_key == "SMoLPU" %}
        <span style="background-color: #17a2b8; color: white; padding: 2px 8px; border-radius: 3px; font-size: 0.85em; font-weight: bold;">Circuit</span>
        <span style="background-color: #28a745; color: white; padding: 2px 8px; border-radius: 3px; font-size: 0.85em; font-weight: bold;">Tape-out</span>
      {% elsif title_key == "NuVPU" %}
        <span style="background-color: #17a2b8; color: white; padding: 2px 8px; border-radius: 3px; font-size: 0.85em; font-weight: bold;">Circuit</span>
        <span style="background-color: #28a745; color: white; padding: 2px 8px; border-radius: 3px; font-size: 0.85em; font-weight: bold;">Tape-out</span>
      {% elsif title_key == "SLYTHERIN" %}
        <span style="background-color: #17a2b8; color: white; padding: 2px 8px; border-radius: 3px; font-size: 0.85em; font-weight: bold;">Circuit</span>
        <span style="background-color: #6c757d; color: white; padding: 2px 8px; border-radius: 3px; font-size: 0.85em; font-weight: bold;">Simulation</span>
      {% endif %}
    </h2>
    
    {% if post.excerpt %}
    <div class="archive__item-excerpt portfolio-excerpt" itemprop="description" style="margin-top: 0.5em;">
      {% assign excerpt_content = post.excerpt | markdownify %}
      <div class="portfolio-excerpt-text">
        {% assign excerpt_text = excerpt_content %}
        {% assign img_split = excerpt_content | split: '<img' %}
        {% if img_split.size > 1 %}
          {{ img_split[0] }}
        {% else %}
          {{ excerpt_text }}
        {% endif %}
      </div>
      {% if img_split.size > 1 %}
      <div class="portfolio-excerpt-images">
        {% for img_part in img_split offset: 1 %}
          {% assign img_tag_start = '<img' | append: img_part | split: '>' | first %}
          {% assign img_full_tag = img_tag_start | append: '>' %}
          {{ img_full_tag }}
        {% endfor %}
      </div>
      {% endif %}
    </div>
    {% endif %}
  </article>
</div>

